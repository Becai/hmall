# HMall 微服务电商系统

## 项目简介

HMall 是一个基于 Spring Cloud 微服务架构的电商系统，采用分布式设计，实现了商品管理、购物车、订单处理、支付、用户管理等完整的电商业务流程。项目采用前后端分离架构，后端使用 Java 技术栈，前端采用 Vue.js 框架。

## 技术栈

### 核心框架
- **Spring Boot 2.7.12** - 基础框架
- **Spring Cloud 2021.0.3** - 微服务框架
- **Spring Cloud Alibaba 2021.0.4.0** - 阿里云微服务组件

### 微服务组件
- **Nacos** - 服务注册与发现、配置中心
- **Gateway** - API 网关
- **OpenFeign** - 服务间调用
- **Sentinel** - 熔断限流
- **Seata** - 分布式事务

### 数据存储
- **MySQL 8.0.23** - 关系型数据库
- **Redis** - 缓存数据库
- **Elasticsearch 7.12.1** - 搜索引擎

### 消息队列
- **RabbitMQ** - 异步消息处理

### 其他技术
- **MyBatis-Plus 3.4.3** - ORM 框架
- **JWT** - 身份认证
- **Hutool 5.8.11** - 工具类库
- **Knife4j** - API 文档

## 系统架构

### 微服务模块

| 服务名称 | 端口 | 主要功能 |
|---------|------|----------|
| hm-gateway | 8080 | API 网关，统一入口 |
| user-service | 8081 | 用户管理服务 |
| cart-service | 8082 | 购物车服务 |
| item-service | 8083 | 商品管理服务 |
| trade-service | 8084 | 订单交易服务 |
| pay-service | 8085 | 支付服务 |
| search-service | 8087 | 商品搜索服务 |
| hm-service | 8080 | 单体服务（备用） |

### 核心模块说明

#### 1. API 网关 (hm-gateway)
- 统一入口，路由转发
- JWT 身份认证
- 动态路由配置
- 请求过滤和限流

#### 2. 用户服务 (user-service)
- 用户注册、登录、认证
- 用户信息管理
- 余额管理
- JWT Token 生成

#### 3. 商品服务 (item-service)
- 商品 CRUD 操作
- 库存管理
- 商品缓存优化
- 商品数据同步到 ES

#### 4. 购物车服务 (cart-service)
- 购物车商品管理
- 购物车缓存优化
- 分布式锁防击穿

#### 5. 订单服务 (trade-service)
- 订单创建和管理
- 订单状态流转
- 分布式事务处理
- 延迟消息处理

#### 6. 支付服务 (pay-service)
- 支付流程处理
- 支付状态管理
- 余额支付
- 幂等性控制

#### 7. 搜索服务 (search-service)
- 商品搜索
- 搜索聚合
- 高亮显示
- 分类品牌聚合

## 核心功能特性

### 1. 分布式事务
- 使用 Seata 实现分布式事务
- 订单创建时涉及多个服务的数据一致性
- 支付流程的事务保证

### 2. 缓存优化
- Redis 缓存商品信息
- 购物车数据缓存
- 缓存击穿防护（分布式锁）
- 缓存穿透防护（空值缓存）

### 3. 消息队列
- RabbitMQ 异步处理
- 商品数据同步到 ES
- 订单延迟取消
- 支付状态通知

### 4. 搜索功能
- Elasticsearch 全文搜索
- 商品分类聚合
- 品牌聚合
- 价格区间过滤

### 5. 熔断降级
- Sentinel 熔断限流
- Feign 降级处理
- 服务容错机制

### 6. 安全认证
- JWT Token 认证
- 网关统一鉴权
- 密码加密存储

## 技术亮点

### 1. 微服务架构设计
- 服务拆分合理，职责单一
- 服务间解耦，独立部署
- 统一配置管理

### 2. 性能优化
- 多级缓存策略
- 数据库连接池优化
- 异步处理机制
- 分布式锁防并发

### 3. 高可用设计
- 服务注册发现
- 负载均衡
- 熔断降级
- 容错机制

### 4. 数据一致性
- 分布式事务
- 最终一致性
- 幂等性设计
- 状态机管理

## 核心技术实现

### 1. 商品服务缓存优化
- **多级缓存策略**：Redis 缓存商品信息，采用 Hash 结构存储批量商品数据
- **缓存击穿防护**：使用分布式锁（Redis SETNX）防止缓存击穿
- **缓存穿透防护**：对空结果进行缓存，设置较短的过期时间
- **缓存更新机制**：商品信息变更时自动清理相关缓存，保证数据一致性

### 2. 购物车服务优化
- **用户购物车缓存**：Redis 缓存用户购物车数据，提升查询性能
- **分布式锁防并发**：添加商品时使用分布式锁防止并发问题
- **缓存失效策略**：购物车数据变更时立即清理缓存，确保数据实时性

### 3. 异步消息队列处理
- **商品数据同步**：商品信息变更时通过 RabbitMQ 异步同步到 Elasticsearch
- **订单延迟处理**：使用延迟队列处理订单超时取消，自动恢复库存
- **支付状态通知**：支付完成后异步通知订单服务更新订单状态
- **消息可靠性**：采用消息确认机制和重试策略保证消息不丢失

### 4. 搜索服务全文检索
- **Elasticsearch 集成**：商品数据自动同步到 ES 索引库
- **全文搜索**：支持商品名称、分类、品牌等多字段搜索
- **搜索聚合**：实现分类聚合、品牌聚合、价格区间过滤
- **高亮显示**：搜索结果关键词高亮，提升用户体验
- **排序优化**：支持按价格、销量、更新时间等多维度排序

### 5. 分布式事务处理
- **Seata 集成**：使用 Seata 实现跨服务的分布式事务
- **订单创建事务**：订单创建涉及库存扣减、购物车清理、订单保存等操作
- **支付事务**：支付流程涉及余额扣减、支付单状态更新、订单状态更新
- **事务回滚**：异常情况下自动回滚，保证数据一致性

### 6. 熔断降级机制
- **Sentinel 集成**：实现服务熔断、限流、降级
- **Feign 降级**：服务调用失败时自动降级，返回默认值
- **服务容错**：商品服务不可用时，购物车服务仍可正常使用
- **降级策略**：根据业务重要性设置不同的降级策略





## 总结

HMall 微服务电商系统是一个功能完整、架构合理的电商解决方案，采用了当前主流的微服务技术栈，具备高可用、高性能、可扩展的特点。项目涵盖了电商系统的核心业务流程，包括用户管理、商品管理、购物车、订单处理、支付等模块，为电商业务提供了完整的技术支撑。

### 技术亮点总结
1. **微服务架构**：服务拆分合理，独立部署
2. **分布式事务**：保证数据一致性
3. **缓存优化**：提升系统性能
4. **异步处理**：提高系统吞吐量
5. **熔断降级**：保证系统稳定性
6. **安全认证**：保护系统安全
7. **搜索功能**：提供良好的用户体验

